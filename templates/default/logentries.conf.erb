$Modload imfile

# Only entered once in case of following multiple files
$InputFilePollInterval 1

<% node['le_rsyslog']['logentries']['logs'].each do |syslog| -%>
$InputFileName <%= syslog[:log] %>
$InputFileTag <%= syslog[:name] %>
$InputFileStateFile <%= syslog[:name] %>-state
$InputFileSeverity info
$InputFileFacility local7
$InputRunFileMonitor


$template <%= syslog[:name] %>-template,"<%= syslog[:token]%> %HOSTNAME% %syslogtag% %msg%\n"

if $programname == '<%= syslog[:name] %>' then @@data.logentries.com:10000;<%= syslog[:name] %>-template
& ~

<% end -%>